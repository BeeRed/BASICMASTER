//
//		Character convert table
//			from UNICODE to BASICMASTER
//
#include	"common.h"

typedef	struct	{
		char	*from;
		char	*to;
		} pair_t;
pair_t table[] = {
			{"„ÄÄ",		"$20" },		// ÂÖ®Ëßí„Çπ„Éö„Éº„Çπ
			{"Œ±",		"$10" },
			{"Œ≤",		"$11" },
			{"Œ≥",		"$12" },
			{"Œ∑",		"$13" },
			{"Œ∏",		"$14" },
			{"Œª",		"$15" },
			{"Œº",		"$16" },
			{"œÄ",		"$17" },
			{"œÑ",		"$18" },
			{"œÜ",		"$19" },
			{"Œ¶",		"$19" },
			{"œà",		"$1a" },
			{"Œ®",		"$1a" },
			{"œâ",		"$1b" },
			{"Œ£",		"$1c" },
			{"Œ©",		"$1d" },
			{"œá",		"$1e" },
			{"√∑",		"$1f" },
			{"‚ûó",		"$1f" },
			{"Ôø•",		"$5c" },
			{"‚ñ†",		"$60" },
			{"‚Üê",		"$7b" },
			{"‚Üí",		"$7c" },
			{"‚Üì",		"$7d" },
			{"‚Üë",		"$7e" },
			{"‚îº",		"$80" },	// ÁΩ´Á∑öÁ¥†Áâá
			{"‚ïã",		"$80" },
			{"‚îî",		"$81" },
			{"‚îó",		"$81" },
			{"‚îò",		"$82" },
			{"‚îõ",		"$82" },
			{"‚îê",		"$83" },
			{"‚îì",		"$83" },
			{"‚îå",		"$84" },
			{"‚îè",		"$84" },
			{"‚îÄ",		"$85" },
			{"‚îÅ",		"$85" },
			{"‚îÇ",		"$86" },
			{"‚îÉ",		"$86" },
			{"‚úõ",		"$87" },	// U+271B
//			{"+ÔΩ•",		"$87" },	// 2B U+FF65
			{"‚î§",		"$88" },
			{"‚î´",		"$88" },
			{"‚î¨",		"$89" },
			{"‚î≥",		"$89" },
			{"‚îú",		"$8a" },
			{"‚î£",		"$8a" },
			{"‚î¥",		"$8b" },
			{"‚îª",		"$8b" },
			{"‚ï∞",		"$8c" },
			{"‚ïØ",		"$8d" },
			{"‚ïÆ",		"$8e" },
			{"‚ï≠",		"$8f" },
			{"‚å©",		"$90" },	// U+2329
			{"‚åÑ",		"$91" },	// U+2304
			{"‚å™",		"$92" },	// U+232A
			{"‚åÉ",		"$93" },	// U+2303
			{"‚ó¶",		"$94" },	// U+25E6
			{"‚óã",		"$94" },	// U+25CB
			{"‚óè",		"$95" },	// U+25CF
			{"‚ô£",		"$96" },	// U+2663
			{"‚ôß",		"$96" },	// U+2667
			{"‚ô¢",		"$97" },	// U+2662
			{"‚ô¶",		"$97" },	// U+2662
			{"‚ô°",		"$98" },	// U+2661
			{"‚ô•",		"$98" },	// U+2665
			{"‚ô†",		"$99" },	// U+2660
			{"‚ô§",		"$99" },	// U+2660
			{"Âá∫",		"$9a" },	// Êº¢Â≠ó„ÅÆ„ÄåÂá∫„Äç
			{"‚ô™",		"$9b" },	// U+266A
			{"üêÉ",		"$9c" },	// U+1F403
			{"üêÇ",		"$9c" },	// U+1F402
			{"üêÑ",		"$9c" },	// U+1F404
			{"Áâõ",		"$9c" },
			{"‚ôû",		"$9c" },	// U+265E	// j68
			{"‚ñí",		"$9d" },	// U+2592
			{"‚ñë",		"$9d" },	// U+2591
			{"‚ñì",		"$9d" },	// U+2593
			{"ÂÆ∂",		"$9e" },
			{"‚ôü",		"$9e" },	// U+265F	// j68
			{"‚ñ≤",		"$9e" },	// U+25B2
			{"\\",		"$9f" },
			{"Ôπ®",		"$9f" },	// U+FE68
			{"„ÄÇ",		"$a1" },
			{"„Äå",		"$a2" },
			{"„Äç",		"$a3" },
			{"„ÄÅ",		"$a4" },
			{"„Éª",		"$a5" },
			{"„É≤",		"$a6" },
			{"„Ç°",		"$a7" },
			{"„Ç£",		"$a8" },
			{"„Ç•",		"$a9" },
			{"„Çß",		"$aa" },
			{"„Ç©",		"$ab" },
			{"„É£",		"$ac" },
			{"„É•",		"$ad" },
			{"„Éß",		"$ae" },
			{"„ÉÉ",		"$af" },
			{"„Éº",		"$b0" },
			{"„Ç¢",		"$b1" },
			{"„Ç§",		"$b2" },
			{"„Ç¶",		"$b3" },
			{"„Ç®",		"$b4" },
			{"„Ç™",		"$b5" },
			{"„Ç´",		"$b6" },
			{"„Ç¨",		"$b6,$de" },
			{"„Ç≠",		"$b7" },
			{"„ÇÆ",		"$b7,$de" },
			{"„ÇØ",		"$b8" },
			{"„Ç∞",		"$b8,$de" },
			{"„Ç±",		"$b9" },
			{"„Ç≤",		"$b9,$de" },
			{"„Ç≥",		"$ba" },
			{"„Ç¥",		"$ba,$de" },
			{"„Çµ",		"$bb" },
			{"„Ç∂",		"$bb,$de" },
			{"„Ç∑",		"$bc" },
			{"„Ç∏",		"$bc,$de" },
			{"„Çπ",		"$bd" },
			{"„Ç∫",		"$bd,$de" },
			{"„Çª",		"$be" },
			{"„Çº",		"$be,$de" },
			{"„ÇΩ",		"$bf" },
			{"„Çæ",		"$bf,$de" },
			{"„Çø",		"$c0" },
			{"„ÉÄ",		"$c0,$de" },
			{"„ÉÅ",		"$c1" },
			{"„ÉÇ",		"$c1,$de" },
			{"„ÉÑ",		"$c2" },
			{"„ÉÖ",		"$c2,$de" },
			{"„ÉÜ",		"$c3" },
			{"„Éá",		"$c3,$de" },
			{"„Éà",		"$c4" },
			{"„Éâ",		"$c4,$de" },
			{"„Éä",		"$c5" },
			{"„Éã",		"$c6" },
			{"„Éå",		"$c7" },
			{"„Éç",		"$c8" },
			{"„Éé",		"$c9" },
			{"„Éè",		"$ca" },
			{"„Éê",		"$ca,$de" },
			{"„Éë",		"$ca,$df" },
			{"„Éí",		"$cb" },
			{"„Éì",		"$cb,$de" },
			{"„Éî",		"$cb,$df" },
			{"„Éï",		"$cc" },
			{"„Éñ",		"$cc,$de" },
			{"„Éó",		"$cc,$df" },
			{"„Éò",		"$cd" },
			{"„Éô",		"$cd,$de" },
			{"„Éö",		"$cd,$df" },
			{"„Éõ",		"$ce" },
			{"„Éú",		"$ce,$de" },
			{"„Éù",		"$ce,$df" },
			{"„Éû",		"$cf" },
			{"„Éü",		"$d0" },
			{"„É†",		"$d1" },
			{"„É°",		"$d2" },
			{"„É¢",		"$d3" },
			{"„É§",		"$d4" },
			{"„É¶",		"$d5" },
			{"„É®",		"$d6" },
			{"„É©",		"$d7" },
			{"„É™",		"$d8" },
			{"„É´",		"$d9" },
			{"„É¨",		"$da" },
			{"„É≠",		"$db" },
			{"„ÉØ",		"$dc" },
			{"„É≥",		"$dd" },
			{"„Çõ",		"$de" },
			{"„Çú",		"$df" },
			{"ÊôÇ",		"$e0" },
			{"ÂàÜ",		"$e1" },
			{"Áßí",		"$e2" },
			{"Âπ¥",		"$e3" },
			{"Êúà",		"$e4" },
			{"Êó•",		"$e5" },
			{"ÁÅ´",		"$e6" },
			{"Ê∞¥",		"$e7" },
			{"Êú®",		"$e8" },
			{"Èáë",		"$e9" },
			{"Âúü",		"$ea" },
			{"‰∫∫",		"$eb" },
			{"ÁÇπ",		"$ec" },
			{"Âõû",		"$ed" },
			{"Êñá",		"$ee" },
			{"Âêç",		"$ef" },
			{"‚ñè",		"$f0" },	// U+258F
			{"‚ñé",		"$f1" },	// U+258E
			{"‚ñç",		"$f2" },	// U+258D
//			{"??",		"$f3" },
//			{"??",		"$f4" },
//			{"??",		"$f5" },
//			{"??",		"$f6" },
//			{"??",		"$f7" },
//			{"??",		"$f8" },
			{"‚ñÅ",		"$f9" },	// U+2581
			{"‚ñÇ",		"$fa" },	// U+2582
			{"‚ñÉ",		"$fb" },	// U+2583
			{"Ôºè",		"$fb" },	// U+FF0F	// j68
			{"‚ï±",		"$fc" },	// U+2571
			{"Ôºº",		"$fd" },	// U+FF3C	// j68
			{"‚ï≤",		"$fd" },	// U+2572
			{"‚óÜ",		"$fe" },	// U+25c6	// j68
			{"‚ßì",		"$fe" },	// U+29D3
			{"‚óá",		"$ff" },	// U+25c7	// j68
			{"‚ßó",		"$ff" },	// U+29D7
			{NULL,		NULL },
		};

char	*
escape_bmchar(char *str)
{
	char	*buf = calloc(1,2000);
	char	*bp = buf;
	char	*p = str;
	int		in = -1;			// escape mode?
	char	*FCB="\tFCB\t";
	char	*FCC="\tFCC\t'";

	while(*p){
		if(bp-buf>1000){ goto toolong; }
		if(*p=='\'' || *p=='\\' || *p==0x7F){
			if(in==-1) {
				in = 1;
				memcpy(bp,FCB,strlen(FCB));
				bp+=strlen(FCB);
			}else if(in==0){
				*bp++ = '\n';
				memcpy(bp,FCB,strlen(FCB));
				bp+=strlen(FCB);
				in = 1;
			}else if(in==1){
				if(bp-buf>1000){ goto toolong; }
				*bp++ = ',';
			}
			char s[10];
			sprintf(s,"$%02x",*p++);
			memcpy(bp,s,strlen(s));
			bp+=strlen(s);
		}else if(*p>=0x20 && *p<=0x7E){				// ASCII
			if(in==-1) {
				memcpy(bp,FCC,strlen(FCC));
				bp+=strlen(FCC);
				in = 0;
			}else if(in==1){
				*bp++='\n';
				memcpy(bp,FCC,strlen(FCC));
				bp+=strlen(FCC);
				in = 0;
			}
			if(bp-buf>1000){ goto toolong; }
			*bp++ = *p++;
			continue;
		}else{									// not ASCII, escape it!
			if(in==-1) {
				memcpy(bp,FCB,strlen(FCB));
				bp+=strlen(FCB);
				in = 1;
			}else if(in==0){
				*bp++ = '\'';
				*bp++ = '\n';
				memcpy(bp,FCB,strlen(FCB));
				bp+=strlen(FCB);
				in = 1;
			}else if(in==1){
				if(bp-buf>1000){ goto toolong; }
				*bp++ = ',';
			}
			int i=0;
			for(i=0; table[i].from!=NULL; i++) {
				if(memcmp(p,table[i].from,strlen(table[i].from))==0) {	// Â§âÊèõ„Åô„Çã
					memcpy(bp,table[i].to,strlen(table[i].to));
					p+=strlen(table[i].from);
					bp+=strlen(table[i].to);
					break;
				}
			}
			if(table[i].from==NULL){
				error("; convert error");
			}
		}
	}
	if(in==0){
		*bp++ = '\'';
		*bp++ = '\n';
	}else if(in==1){
		*bp++ = '\n';
	}
	return buf;
toolong:
	*bp='\0';
	error("; too long string. what? '%s'\n",buf);
	return buf;
}
